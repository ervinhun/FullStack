<!DOCTYPE html>
<html>
<body>
<div id="messages"></div>
<input id="msg" placeholder="Message" />
<button onclick="send()">Send</button>
<button onclick="poke()">Poke</button>
<script>
    const room = "chat";
    let connectionId;

    const es = new EventSource("/connect");
    es.addEventListener("connected", e => {
        connectionId = JSON.parse(e.data).connectionId;
        fetch(`/join?connectionId=${connectionId}&room=${room}`, { method: "POST" });
    });
    es.addEventListener(room, e => {
        document.getElementById("messages").innerHTML += `<p>${JSON.parse(e.data).message}</p>`;
    });
    es.addEventListener(room, e => {
        document.getElementById("joined").innerHTML += `<p>${JSON.parse(e.data).message}</p>`;
    })

    function send() {
        fetch(`/send?room=${room}&message=${document.getElementById("msg").value}`, { method: "POST" });
        document.getElementById("msg").value = "";
    }
    
    function poke() {
        fetch(`/poke?connectionId=${connectionId}`, { method: "POST" });
    }
</script>
</body>
</html>